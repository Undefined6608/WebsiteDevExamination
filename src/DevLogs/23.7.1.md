# 项目开发日志

## 23.7.1

### 一、创建项目

在`github`上创建`WebsiteDevExamination`，使用`git clone git@github.com:Undefined6608/WebsiteDevExamination.git`将其克隆到本地

### 二、初始化项目

在`WebStorm`中创建`vite`项目：

```shell
npx create-vite
```

选择`Template`为`React`并且勾选`Use TypeScript template`

创建后运行以下命令：

```shell
npm i
```

### 三、创建项目内部文件夹

项目文件夹对应存储类型：

| 文件夹名称 | 作用                |
| ---------- | ------------------- |
| assets     | 存储静态数据        |
| components | 存储组件            |
| config     | 存储配置文件        |
| DevLog     | 存储开发日志        |
| less       | 存储less/层叠样式表 |
| pages      | 存储页面组件        |
| router     | 存储路由            |
| utils      | 存储工具文件        |

项目整体结构

![](http://39.101.72.168:81/image/examination/log/Snipaste_2023-07-02_10-18-12.png)

### 四、创建公共文件

| 文件名及其位置            | 作用               |
| ------------------------- | ------------------ |
| config/publicInterface.ts | 公共接口文件       |
| config/request.ts         | 封装fetch          |
| config/responseType.ts    | 服务器响应数据接口 |
| utils/index.ts            | 工具文件           |

### 五、安装/配置依赖

用到的依赖及作用：

| 依赖             | 作用                                |
| ---------------- | ----------------------------------- |
| ant-design/icons | AntDesign组件库图标                 |
| antd             | AntDesign组件库                     |
| pubsub-js        | 订阅与发布依赖                      |
| less             | CSS与编译器                         |
| less-loader      | CSS与编译器，与上面的less都需要安装 |
| react-router-dom | 路由，用于控制页面显示              |

安装命令：

```shell
npm i ant-design/icons antd
npm i pubsub-js
npm i less less-loader
npm install react-router-dom @types/react-router-dom
```

配置：

`less`配置：在`vite.config.ts`中：

```ts
import {defineConfig} from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
    plugins: [react()],
    css: {
        preprocessorOptions: {
            less: {
                javascriptEnabled: true,
            },
        },
    },
})
```

跨域配置：在`vite.config.ts`中：

```ts
server: {
        proxy: {
            // 设置你需要跨域的请求地址
            '/api': {
                target: 'http://192.168.126.1:4000/', // 替换成你的API地址
                changeOrigin: true
            },
        },
    }
```

`router`路由配置：

在`pages`文件夹中创建`home.tsx`、`about.tsx`、`product.tsx`、`information.tsx`、`contact.tsx`页面组件

在`router`文件夹下创建`appRouter.tsx`文件：

```tsx
import {BrowserRouter as Router, Routes, Route} from "react-router-dom";
import {Home} from "../pages/home";
import {About} from "../pages/about";
import {Product} from "../pages/product";
import {Information} from "../pages/information";
import {Contact} from "../pages/contact";

export const AppRouter = () => {
    return (
        <>
            <Router>
                <Routes>
                    <Route path={"/"} element={<Home/>}></Route>
                    <Route path={"/about"} element={<About/>}></Route>
                    <Route path={"/product"} element={<Product/>}></Route>
                    <Route path={"/information"} element={<Information/>}></Route>
                    <Route path={"/contact"} element={<Contact/>}></Route>
                </Routes>
            </Router>
        </>
    )
}
```

在`App.tsx`中：

```tsx
import './App.less'
import {AppRouter} from "./router/appRouter";

function App() {
    return (
        <div className="App">
            <AppRouter />
        </div>
    )
}

export default App

```

### 六、封装依赖

`fetch`：在`config/request.ts`中：

```ts
import PubSub from "pubsub-js";
import {NotificationType} from "./publicInterface";

// 定义后端地址
export const BASE_URL = '/api';

// 定义返回值类型模型
// T:接受的返回值类型
interface ApiResponse<T> {
    // 响应值
    code: number;
    // 响应信息
    msg: string;
    // 响应数据
    data: T;
}

// 网络连接失败
async function handleResponse<T>(response: Response): Promise<ApiResponse<T>> {
    if (!response.ok) {
        throw new Error('网络请求失败');
    }
    return await response.json();
}

// get请求
export async function get<T>(url: string): Promise<ApiResponse<T>> {
    const response = await fetch(BASE_URL + url);
    return await handleResponse<T>(response);
}

// post请求
export async function post<T>(url: string, body: any): Promise<ApiResponse<T>> {
    const response = await fetch(BASE_URL + url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(body),
    });
    return await handleResponse<T>(response);
}
```

## 23.7.2

> 本项目开发的顺序为：从小到大开发
>
> - 公共小组件
> - 公共大组件
> - 页面内部组件
> - 页面调用上面的组件

### 一、开始编写项目

#### I、定义公共接口

在`publicInteerface.ts`中：

```ts
// 定义页面传参公共接口
export type SizeType = {
    // 页面宽度
    width: string,
    // 页面高度
    height: string,
    // 外边距
    margin: string
}
```

#### II、提示组件

利用`Ant Design`的`notification`实现提示。

在`publicInterface.ts`中：

```ts
// 定义提示类型接口
export type NotificationType = 'success' | 'info' | 'warning' | 'error';
```

在`components`中创建`tipsComponent.tsx`组件：

```tsx
// 引入React相关组件
import React, {useEffect} from "react";
// 引入AntDesign组件
import {notification} from "antd";
// 引入PubSub实现订阅与发布
import PubSub from "pubsub-js";
// 引入提示类型接口
import {NotificationType} from "../config/publicInterface";
// 定义传入的数据格式
type MsgType = { type: NotificationType, message: string, description: string };

// 定义TipsComponent组件
export const TipsComponent: React.FC = () => {
    const [api, contextHolder] = notification.useNotification();
    useEffect(() => {
        // 开启提示方法
        const openNotificationWithIcon = (msg: MsgType) => {
            // 修改api实现不同的提示
            api[msg.type]({
                message: msg.message,
                description: msg.description,
            });
        };
        // 通过订阅的方式进行控制提示框的显示
        const tipsToken = PubSub.subscribe('tips', (_, msg: MsgType) => {
            openNotificationWithIcon(msg);
        })
        // 在页面销毁时调用
        return () => {
            // 清除订阅
            PubSub.unsubscribe(tipsToken);
        }
    }, [])
    return (
        <>
            {/*显示组件*/}
            {contextHolder}
        </>
    )
}
```

挂载到路由上，在`appRouter.tex`中：

```tsx
import {BrowserRouter as Router, Routes, Route} from "react-router-dom";
import {Home} from "../pages/home";
import {About} from "../pages/about";
import {Product} from "../pages/product";
import {Information} from "../pages/information";
import {Contact} from "../pages/contact";
import {TipsComponent} from "../components/tipsComponent";

export const AppRouter = () => {
    return (
        <>
            <Router>
                {/*挂载提示组件*/}
                <TipsComponent />
                {/*路由显示不同的页面*/}
                <Routes>
                    <Route path={"/"} element={<Home/>}></Route>
                    <Route path={"/about"} element={<About/>}></Route>
                    <Route path={"/product"} element={<Product/>}></Route>
                    <Route path={"/information"} element={<Information/>}></Route>
                    <Route path={"/contact"} element={<Contact/>}></Route>
                </Routes>

            </Router>
        </>
    )
}
```

在`utils/index.ts`工具文件里，写入开启提示的方法，在其他文件中可以通过调用以下方法 进行开启提示。

```ts
import {NotificationType} from "../config/publicInterface";
import PubSub from "pubsub-js";

/**
 * 提示
 * @param type 提示类型
 * @param description
 * @param message
 */
export const handlerTips = (type: NotificationType, description: string, message?: string | '请求失败') => {
    return PubSub.publish('tips', {type: type, message: message, description: description});
}
```

#### III、头部左侧标题组件

在`config/responseType.ts`中：

```ts
// logo的类型
export type GetLogoType = {
    icon: string
}
// 副标题的类型
export type GetSubTitle = {
    title: string
}
```

在`components`目录下创建`titleComponent.tsx`：

```tsx
// 引入React依赖
import React, {useEffect, useState} from "react";
// 引入gqt请求方法
import {get} from "../config/request";
// 引入logo和副标题响应值类型
import {GetLogoType, GetSubTitle} from "../config/responseType";
// 引入组件样式
import "../less/titleComponent.less";
// 引入公共组件参数接口
import {SizeType} from "../config/publicInterface";
// 引入开启提示的方法
import {handlerTips} from "../utils";

export const TitleComponent: React.FC<SizeType> = ({width, height, margin}) => {
    // 定义logo状态
    const [logo, setLogo] = useState<string>('');
    // 定义副标题状态
    const [subTitle, setSubTitle] = useState<string>('');
    // 组件创建完成后
    useEffect(() => {
        // 调取api接口获取logo
        get<GetLogoType>('/public/logo').then((r) => {
            // 如果等于200，返回data数据
            if (r.code === 200) return r.data;
            // 开启提示
            handlerTips('warning', r.msg);
        }).then((r) => {
            // 输出获取到的数据
            console.log(r);
            // 如果存在logo地址，则保存logo地址
            if (r) return setLogo(r.icon);
        })
        // 同理
        get<GetSubTitle>('/public/subTitle').then((r) => {
            if (r.code === 200) return r.data;
            handlerTips('warning', r.msg);
        }).then((r) => {
            console.log(r);
            if (r) return setSubTitle(r.title);
        })
    }, []);
    return (
        <>
            {/*将父组件传来的组件样式设置为div样式*/}
            <div className="headerTitle" style={{width: width, height: height, margin: margin}}>
                {/*logo图片显示*/}
                <img className={"logo"} src={logo} alt=""/>
                {/*副标题显示*/}
                <span className="subtitle"> {subTitle} </span>
            </div>
        </>
    )
}
```

在`less`目录下创建`titleComponent.less`:

```less
.headerTitle {
  display: flex;
  flex-wrap: wrap;
  align-items: center;

  .logo {
    width: auto;
    height: 50%;
    margin-right: 30px;
  }

  .subtitle {
    font-size: 24px;
    font-family: 'fontface__幼圆__7__752086772492', serif;
    height: 60px;
    display: flex;
    align-items: flex-end;
  }
}
```

效果图：

![](http://39.101.72.168:81/image/examination/log/Snipaste_2023-07-02_13-28-11.png)



#### IV、头部右侧导航列表

在`config/responseType.ts`中：

```ts
// 导航列表内部对象类型
export type GetNavItem = {
    id: string,
    name: string,
    subName: string,
    url: string
}
```

在`components`中创建`headerNav.tsx`：

```tsx
// 引入React组件
import React, {useEffect, useState} from "react";
// 引入公共组件参数接口
import {SizeType} from "../config/publicInterface";
// 引入gqt请求方法
import {get} from "../config/request";
// 引入导航栏单个条目响应值类型
import {GetNavItem} from "../config/responseType";
// 引入开启提示的方法
import {handlerTips} from "../utils";
// 引入路由跳转组件
import {Link} from "react-router-dom";
// 引入导航条样式
import "../less/headerNav.less";

/**
 * 创建HeaderNav组件
 * @param width 组件宽慰
 * @param height 组件高度
 * @param margin 组件外边距
 * @constructor
 */
export const HeaderNav: React.FC<SizeType> = ({width, height, margin}) => {
    // 创建导航列表状态
    const [navList, setNavLiat] = useState<Array<GetNavItem>>([]);
    // 创建选择条目状态，默认为 a
    const [status, setStatus] = useState<string>('a');
    // 组件被调用时执行一次
    useEffect(() => {
        // 通过get请求，获取导航条的数据
        get<{ list: Array<GetNavItem> }>('/public/navList').then((r) => {
            // 如果响应值为200 则返回数据
            if (r.code === 200) return r.data.list
            // 如果不为200，则给出提示
            handlerTips('warning', r.msg);
        }).then((r) => {
            // 输出查看响应数据
            console.log(r);
            // 如果数据存在，则保存数据到状态中
            if (r) return setNavLiat(r);
        })
    }, [])
    return (
        <>
            {/*将父组件传来的组件样式设置为div样式*/}
            <div className={"headerNav"} style={{width: width, height: height, margin: margin}}>
                {/*判断导航条数据是否存在*/}
                {navList ?
                    // 如果不为空，循环遍历导航条数据
                    navList.map((value) => (
                        // 渲染为可点击的路由组件
                        <Link key={value.id} className={status === value.id ? "header-link active" : "header-link"}
                              to={value.url} children={value.name} onClick={(e) => setStatus(value.id)}/>
                    )) :
                    // 如果为空，则不渲染
                    null}
            </div>
        </>
    )
}
```

在`less`文件夹中创建`headerNav.less`：

```less
.headerNav {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  border-radius: 20px;
  overflow: hidden;
  border: 1px solid var(--border-black);

  .header-link {
    display: inline-block;
    flex: 1;
    height: 100%;
    text-align: center;
    line-height: 40px;
    text-decoration: none;
    color: var(--color);
    background-color: var(--background-color);
  }

  .active {
    color: var(--background-color);
    background-color: var(--color);
  }
}
```

效果图：

![](http://39.101.72.168:81/image/examination/log/Snipaste_2023-07-02_13-47-17.png)

#### V、头部组件

在`components`中创建`headerComponent.tsx`：

```tsx
// 引入React
import React from "react";
// 引入公共组件参数接口
import {SizeType} from "../config/publicInterface";
// 引入头部组件样式
import "../less/headerComponent.less";
// 引入子组件
import {TitleComponent} from "./titleComponent";
import {HeaderNav} from "./headerNav";

/**
 * 创建头部组件
 * @param width 组件宽度
 * @param height 组件高度
 * @param margin 组件外边距
 * @constructor
 */
export const HeaderComponent: React.FC<SizeType> = ({width, height, margin}) => {
    return (
        <>
            {/*将父组件传来的组件样式设置为div样式*/}
            <div className={"header"} style={{width: width, height: height, margin: margin}}>
                {/*挂载头部左侧标题组件*/}
                <TitleComponent width={"330"} height={"150px"} margin={"0"}/>
                {/*挂载头部右侧导航列表*/}
                <HeaderNav width={"646px"} height={"40px"} margin={"0"}/>
            </div>
        </>
    )
}
```

在`less`文件夹中创建`headerComponent.less`：

```less
.header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-around;
}
```

将头部组件挂载到路由上，形成公共组件





























